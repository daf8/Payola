@(user: Option[cz.payola.domain.entities.User], transformers: Seq[cz.payola.domain.entities.Transformer], page: Int = 1, title: Option[String] = None)

@import tags._

@detailsLinkForID(id: String, name: String) = @{
<a href={routes.Transformer.detail(id).toString}>{name}</a>
}

@editLinkForID(id: String) = @{
<div class="btn-group">
    <a href={routes.Transformer.edit(id).toString} class="btn btn-default"><i class="glyphicon-pencil"></i> Edit</a>
</div>
}
@deleteLinkForID(id: String) = @{
<div class="btn-group">
    <a href={routes.Transformer.delete(id).toString} class="btn btn-danger" onclick="return confirm('Are you sure?')"><i class="glyphicon-remove-sign glyphicon"></i> Delete</a>
</div>
}
@shareLinkForID(id: String, name: String, isPublic: Boolean) = @{
    <div class="btn-group share-button-placeholder"
         data-id={id}
         data-name={name}
         data-is-public={isPublic.toString}>
     </div>
}
@checkedForID(id: String, checked: String) = @{
<div class="btn-group check-button-placeholder"
     data-id={id}
     data-checked={checked}>
</div>
}

@ownedBy(owner: String) = @{
    <span class="badge badge-inverse">Not editable, owned by {owner}</span>
}

@list_entities(user, "transformer", "transformers", transformers.size, {(page, countPerPage) =>
    transformers.drop((page-1)*countPerPage).take(countPerPage)
},{ Unit =>
new scala.xml.NodeBuffer() ++=
<td>Name</td>
<td>Actions</td>
<td><a href="check" class="btn btn-success input"><i class="glyphicon-check glyphicon"></i> Check all transformers</a></td>
}, { e: cz.payola.domain.Entity =>
val transformer = e.asInstanceOf[cz.payola.domain.entities.Transformer]
<td class="listing-name">{
    detailsLinkForID(e.id, transformer.name)
    }
</td>
<td>{
        if (transformer.owner.isDefined && (user == transformer.owner)){
            <div class="btn-toolbar">
                {val buff = new scala.xml.NodeBuffer() += (editLinkForID(e.id),{<span> </span>})
                buff ++= shareLinkForID(e.id, transformer.name, transformer.isPublic)
                buff += ({<span> </span>},deleteLinkForID(e.id))}
            </div>
        } else if(transformer.owner.isDefined) {
            ownedBy(transformer.owner.get.name)
        } else {
            <span class="badge badge-inverse">Not editable</span>
        }
    }
</td>
<td>
    <div class="btn-toolbar">
        {checkedForID(e.id, transformer.checked.toString)}
    </div>
</td>
},
routes.Transformer.create(), page, title)

<script language="javascript" type="text/javascript" src="/javaScriptPackage/cz.payola.web.client.presenters.entity.SharingPresenter"></script>
<script language="javascript" type="text/javascript" src="/javaScriptPackage/cz.payola.web.client.presenters.entity.CheckPresenter"></script>
<script type="text/javascript">
    new cz.payola.web.client.presenters.entity.SharingPresenter(
        document.getElementsByClassName("share-button-placeholder"),
        "@cz.payola.common.Entity.getClassName(classOf[cz.payola.common.entities.Transformer])"
    ).initialize();
    new cz.payola.web.client.presenters.entity.CheckPresenter(
            document.getElementsByClassName("check-button-placeholder")
    ).initialize();
</script>